(()=>{L.ImageOverlay.Rotated=L.ImageOverlay.extend({initialize:function(image,topleft,topright,bottomleft,options){typeof image=="string"?this._url=image:this._rawImage=image,this._topLeft=L.latLng(topleft),this._topRight=L.latLng(topright),this._bottomLeft=L.latLng(bottomleft),L.setOptions(this,options)},onAdd:function(map){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(L.DomUtil.addClass(this._rawImage,"leaflet-interactive"),this.addInteractiveTarget(this._rawImage)),map.on("zoomend resetview",this._reset,this),this.getPane().appendChild(this._image),this._reset()},onRemove:function(map){map.off("zoomend resetview",this._reset,this),L.ImageOverlay.prototype.onRemove.call(this,map)},_initImage:function(){var img=this._rawImage;this._url&&(img=L.DomUtil.create("img"),img.style.display="none",this.options.crossOrigin&&(img.crossOrigin=""),img.src=this._url,this._rawImage=img),L.DomUtil.addClass(img,"leaflet-image-layer");var div=this._image=L.DomUtil.create("div","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));this._updateZIndex(),div.appendChild(img),div.onselectstart=L.Util.falseFn,div.onmousemove=L.Util.falseFn,img.onload=function(){this._reset(),img.style.display="block",this.fire("load")}.bind(this),img.alt=this.options.alt},_reset:function(){var div=this._image;if(this._map){var pxTopLeft=this._map.latLngToLayerPoint(this._topLeft),pxTopRight=this._map.latLngToLayerPoint(this._topRight),pxBottomLeft=this._map.latLngToLayerPoint(this._bottomLeft),pxBottomRight=pxTopRight.subtract(pxTopLeft).add(pxBottomLeft),pxBounds=L.bounds([pxTopLeft,pxTopRight,pxBottomLeft,pxBottomRight]),size=pxBounds.getSize(),pxTopLeftInDiv=pxTopLeft.subtract(pxBounds.min);this._bounds=L.latLngBounds(this._map.layerPointToLatLng(pxBounds.min),this._map.layerPointToLatLng(pxBounds.max)),L.DomUtil.setPosition(div,pxBounds.min),div.style.width=size.x+"px",div.style.height=size.y+"px";var imgW=this._rawImage.width,imgH=this._rawImage.height;if(!(!imgW||!imgH)){var vectorX=pxTopRight.subtract(pxTopLeft),vectorY=pxBottomLeft.subtract(pxTopLeft);this._rawImage.style.transformOrigin="0 0",this._rawImage.style.transform="matrix("+vectorX.x/imgW+", "+vectorX.y/imgW+", "+vectorY.x/imgH+", "+vectorY.y/imgH+", "+pxTopLeftInDiv.x+", "+pxTopLeftInDiv.y+")"}}},reposition:function(topleft,topright,bottomleft){this._topLeft=L.latLng(topleft),this._topRight=L.latLng(topright),this._bottomLeft=L.latLng(bottomleft),this._reset()},setUrl:function(url){return this._url=url,this._rawImage&&(this._rawImage.src=url),this}});L.imageOverlay.rotated=function(imgSrc,topleft,topright,bottomleft,options){return new L.ImageOverlay.Rotated(imgSrc,topleft,topright,bottomleft,options)};})();
